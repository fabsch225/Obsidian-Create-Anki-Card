"use strict";var d=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var w=(r,n)=>{for(var e in n)d(r,e,{get:n[e],enumerable:!0})},f=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of g(n))!k.call(r,s)&&s!==e&&d(r,s,{get:()=>n[s],enumerable:!(t=u(n,s))||t.enumerable});return r};var C=r=>f(d({},"__esModule",{value:!0}),r);var N={};w(N,{default:()=>c});module.exports=C(N);var m=require("obsidian");var o=require("obsidian");var y="http://127.0.0.1:8765";async function l(r,n={}){let t=await(await fetch(y,{method:"POST",body:JSON.stringify({action:r,version:6,params:n})})).json();if(t.error)throw new Error(t.error);return t.result}async function p(){return l("deckNames")}async function h(r,n,e){return l("addNote",{note:{deckName:r,modelName:"Basic",fields:{Front:n,Back:e},tags:["obsidian"]}})}var a=class extends o.Modal{constructor(e,t){super(e);this.deck="";this.title="";this.selectedText=t}async onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Create Anki Card"}),new o.Setting(e).setName("Front (Title)").addText(t=>t.onChange(s=>{this.title=s}));try{let t=await p();new o.Setting(e).setName("Deck").addDropdown(s=>{t.forEach(i=>s.addOption(i,i)),s.onChange(i=>{this.deck=i}),this.deck=t[0],s.setValue(this.deck)})}catch{new o.Notice("Could not connect to Anki. Is Anki running?"),this.close();return}new o.Setting(e).addButton(t=>t.setButtonText("Create Card").setCta().onClick(async()=>{if(!this.title){new o.Notice("Front cannot be empty.");return}try{await h(this.deck,this.title,this.selectedText),new o.Notice("Card created successfully!"),this.close()}catch{new o.Notice("Failed to create card.")}}))}onClose(){this.contentEl.empty()}};var c=class extends m.Plugin{async onload(){this.registerEvent(this.app.workspace.on("editor-menu",(n,e)=>{let t=e.getSelection();t&&t.trim().length>0&&n.addItem(s=>{s.setTitle("Create Anki Card").setIcon("plus-circle").onClick(()=>{new a(this.app,t).open()})})}))}onunload(){}};
