"use strict";var d=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var y=(e,o)=>{for(var n in o)d(e,n,{get:o[n],enumerable:!0})},S=(e,o,n,i)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of w(o))!v.call(e,t)&&t!==n&&d(e,t,{get:()=>o[t],enumerable:!(i=f(o,t))||i.enumerable});return e};var $=e=>S(d({},"__esModule",{value:!0}),e);var N={};y(N,{DEFAULT_SETTINGS:()=>C,default:()=>g});module.exports=$(N);var k=require("obsidian");var a=require("obsidian");var _="http://127.0.0.1:8765";async function p(e,o={}){let i=await(await fetch(_,{method:"POST",body:JSON.stringify({action:e,version:6,params:o})})).json();if(i.error)throw new Error(i.error);return i.result}async function u(){return p("deckNames")}async function h(e,o,n){return p("addNote",{note:{deckName:e,modelName:"Basic",fields:{Front:o,Back:n},tags:["obsidian"]}})}function m(e,o,n){let i=[];return e=e.replace(/```(\w*)\n([\s\S]*?)```/g,(t,s,r)=>{if(n){let c=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<pre style="display:flex; justify-content:center;"><code class="language-${s}">${c}</code></pre>`}else return i.push(t),`__CODE_BLOCK_${i.length-1}__`}),o&&(e=e.replace(/\$\$([\s\S]+?)\$\$/g,(t,s)=>`\\[${s.trim()}\\]`),e=e.replace(/(?<!\$)\$(?!\$)(.+?)(?<!\$)\$(?!\$)/g,(t,s)=>`\\(${s.trim()}\\)`)),i.forEach((t,s)=>{e=e.replace(`__CODE_BLOCK_${s}__`,t)}),e}var l=class extends a.Modal{constructor(n,i,t){super(n);this.plugin=i;this.selectedText=t;this.deck="";this.title=""}async onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("h2",{text:"Create Anki Card"});let i=await this.plugin.getFirstHeadingFromSelection(this.selectedText);this.title=i??"",new a.Setting(n).setName("Front (Title)").addText(t=>{t.onChange(s=>{this.title=s}),t.setValue(this.title)});try{let t=await u();new a.Setting(n).setName("Deck").addDropdown(s=>{t.forEach(c=>s.addOption(c,c));let r=this.plugin.settings.defaultDeck||t[0];this.deck=r,s.setValue(r),s.onChange(async c=>{this.deck=c,this.plugin.settings.defaultDeck=c,await this.plugin.saveSettings()})}),new a.Setting(n).setName("Convert Math ($ \u2192 \\()").addToggle(s=>s.setValue(this.plugin.settings.convertMath).onChange(async r=>{this.plugin.settings.convertMath=r,await this.plugin.saveSettings()})),new a.Setting(n).setName("Convert Code Blocks").addToggle(s=>s.setValue(this.plugin.settings.convertCodeBlocks).onChange(async r=>{this.plugin.settings.convertCodeBlocks=r,await this.plugin.saveSettings()}))}catch{new a.Notice("Could not connect to Anki. Is Anki running?"),this.close();return}new a.Setting(n).addButton(t=>t.setButtonText("Create Card").setCta().onClick(async()=>{if(!this.title){new a.Notice("Front cannot be empty.");return}try{let s=m(this.selectedText,this.plugin.settings.convertMath,this.plugin.settings.convertCodeBlocks);await h(this.deck,this.title,s),new a.Notice("Card created successfully!"),this.close()}catch{new a.Notice("Failed to create card.")}}))}onClose(){this.contentEl.empty()}};var C={defaultDeck:"",convertMath:!0,convertCodeBlocks:!0},g=class extends k.Plugin{constructor(){super(...arguments);this.settings={defaultDeck:"",convertMath:!0,convertCodeBlocks:!0}}getFirstHeadingFromSelection(n){let i=n.split(`
`);console.log(i);for(let t of i){let r=t.trim().match(/^#{1,6}\s+(.*)$/);if(r)return r[1].trim()}return null}async onload(){await this.loadSettings(),this.app.workspace.onLayoutReady(()=>{this.registerEvent(this.app.workspace.on("editor-menu",(n,i)=>{let t=i.getSelection();t&&t.trim().length>0&&n.addItem(s=>{s.setTitle("Create Anki Card").setIcon("plus-circle").onClick(()=>{new l(this.app,this,t).open()})})}))})}async loadSettings(){this.settings=Object.assign({},C,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}onunload(){}};
